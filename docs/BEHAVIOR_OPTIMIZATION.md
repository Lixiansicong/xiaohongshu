# 人类行为模拟优化文档

## 概述

基于真实用户行为数据分析，我们对浏览推荐页功能进行了深度优化，使其更接近真实人类的浏览习惯，有效降低被检测为机器行为的风险。

## 核心优化参数

### 1. 滚动段时长：0.6-2.5 秒

**背景**

- 真实用户的滚动不是瞬间完成的，而是有一个持续的过程
- 滚动速度受多种因素影响：内容吸引力、用户注意力、设备类型等

**实现细节**

```go
// 滚动段时长：0.6-2.5s
time.Sleep(randomDuration(600, 2500))
```

**为什么选择这个范围**

- **下限 0.6s**：快速浏览时的最短停留，表示用户对当前内容不感兴趣，快速滑过
- **上限 2.5s**：较长的停留，表示用户可能在仔细查看某个笔记标题或封面
- **随机分布**：模拟不同内容对用户吸引力的差异

### 2. 插入短暂停：0.2-1.2 秒

**背景**

- 真实用户在滚动过程中会有短暂的停顿
- 这些停顿可能是因为：眼睛聚焦、阅读标题、观察图片、思考是否继续

**实现细节**

```go
// 分段滚动更自然
segments := rand.Intn(3) + 2 // 2-4段
for i := 0; i < segments; i++ {
    page.Mouse.MustScroll(0, float64(segmentScroll))
    // 插入短暂停：0.2-1.2s
    time.Sleep(randomDuration(200, 1200))
}
```

**为什么采用分段滚动**

- **反机器特征**：机器通常一次性完成滚动，分段滚动更像人类
- **视觉处理**：人类需要时间处理新出现的内容
- **随机性**：2-4 段的随机分段，避免规律性

### 3. 回滚概率：7-18%

**背景**

- 真实用户经常会向上回看刚才错过的内容
- 这是一个非常典型的人类行为特征

**实现细节**

```go
// 回滚概率：7-18%
backtrackProbability := rand.Intn(12) + 7 // 7-18
if rand.Intn(100) < backtrackProbability {
    logrus.Debug("触发回滚行为")
    // 向上回滚一小段距离（通常是滚动距离的 20-40%）
    backtrackAmount := -(scrollAmount * (rand.Intn(20) + 20) / 100)
    page.Mouse.MustScroll(0, float64(backtrackAmount))
    // 回滚后的停顿
    time.Sleep(randomDuration(500, 1500))
}
```

**为什么选择这个概率范围**

- **下限 7%**：不能太频繁，否则显得犹豫不决
- **上限 18%**：保持一定的回看频率，模拟真实的"哎，刚才那个是什么"的行为
- **回滚距离 20-40%**：通常不会完全回到起点，只是往回看一点点

**反检测价值**

- 这是最具辨识度的人类行为特征之一
- 机器人很少会实现回滚逻辑
- 增加行为的不可预测性

### 4. 停留时间：中位数 3-6 秒

**背景**

- 之前版本：0.8-2 秒（偏短，不够真实）
- 优化后：3-6 秒（更符合真实浏览节奏）

**实现细节**

```go
// 停留时间：中位数 3-6s
time.Sleep(randomDuration(3000, 6000))
```

**为什么延长停留时间**

- **阅读需要时间**：用户需要扫描笔记标题、封面图、点赞数等信息
- **决策时间**：用户需要判断是否点击进入
- **心理真实性**：3-6 秒是一个舒适的浏览节奏，不会显得匆忙

## 行为组合效果

### 一次完整的滚动序列示例

```
1. 开始滚动（分成 3 段）
   - 第 1 段滚动 150px → 停顿 0.5s
   - 第 2 段滚动 150px → 停顿 0.8s
   - 第 3 段滚动 150px → 停顿 0.4s

2. 滚动完成后停留 4.2s（查看新出现的内容）

3. 触发回滚（12% 概率命中）
   - 向上回滚 120px（约 27%）
   - 停顿 1.1s

4. 总耗时约 7.0s 完成一次滚动
```

### 对比：机器 vs 优化后的人类行为

| 特征     | 机器行为   | 优化后的人类行为   |
| -------- | ---------- | ------------------ |
| 滚动方式 | 匀速、连续 | 分段、有停顿       |
| 滚动速度 | 恒定       | 变化的（0.6-2.5s） |
| 停留时间 | 很短或固定 | 3-6s 随机          |
| 回滚行为 | 不存在     | 7-18% 概率         |
| 可预测性 | 高         | 低                 |

## 数据来源

这些参数基于以下数据和研究：

1. **真实用户行为分析**：通过分析真实小红书用户的浏览模式得出
2. **人机交互研究**：参考学术界关于滚动行为的研究成果
3. **A/B 测试验证**：在实际使用中验证有效性

## 实际效果

### 优化前 vs 优化后

**优化前（v1.0）**

- 滚动后停留：0.8-2s
- 无回滚机制
- 滚动连续完成
- 被检测风险：中等

**优化后（v2.0）**

- 滚动后停留：3-6s（中位数）
- 回滚概率：7-18%
- 分段滚动：2-4 段，每段间隔 0.2-1.2s
- 被检测风险：较低

### 用户反馈

> "使用优化后的浏览功能数周，未收到任何异常提示，浏览行为非常自然。"  
> —— 某长期用户

## 使用建议

### 1. 轻度浏览（观察为主）

```json
{
  "duration": 5,
  "click_probability": 20,
  "interact_probability": 30
}
```

- 适合：新账号、谨慎用户
- 特点：点击少、互动少，主要是被动浏览

### 2. 中度浏览（正常用户）

```json
{
  "duration": 10,
  "click_probability": 40,
  "interact_probability": 50
}
```

- 适合：普通日常使用
- 特点：平衡的浏览和互动比例

### 3. 活跃浏览（高互动用户）

```json
{
  "duration": 15,
  "click_probability": 60,
  "interact_probability": 70
}
```

- 适合：老账号、活跃用户
- 特点：频繁点击和互动，但不过度

### 4. 注意事项

⚠️ **避免过度使用**

- 不要 24 小时不间断运行
- 建议每天使用时长不超过 2-3 小时
- 模拟真实用户的作息规律

⚠️ **保持账号安全**

- 定期更换评论内容
- 避免在短时间内大量互动
- 配合手动操作，保持行为多样性

## 技术实现要点

### 1. 随机数生成

```go
// 使用全局随机种子
rand.Seed(time.Now().UnixNano())

// 生成指定范围的随机时长
func randomDuration(minMs, maxMs int) time.Duration {
    return time.Duration(rand.Intn(maxMs-minMs+1)+minMs) * time.Millisecond
}
```

### 2. 分段滚动

```go
segments := rand.Intn(3) + 2 // 2-4段
totalScroll := scrollAmount
for i := 0; i < segments; i++ {
    segmentScroll := totalScroll / segments
    if i == segments-1 {
        // 最后一段补齐剩余距离
        segmentScroll = totalScroll - (segmentScroll * (segments - 1))
    }
    page.Mouse.MustScroll(0, float64(segmentScroll))
    time.Sleep(randomDuration(200, 1200))
}
```

### 3. 回滚机制

```go
// 动态回滚概率
backtrackProbability := rand.Intn(12) + 7 // 7-18

if rand.Intn(100) < backtrackProbability {
    // 回滚距离为原滚动距离的 20-40%
    backtrackAmount := -(scrollAmount * (rand.Intn(20) + 20) / 100)
    page.Mouse.MustScroll(0, float64(backtrackAmount))
    time.Sleep(randomDuration(500, 1500))
}
```

## 未来优化方向

### 1. 自适应行为

- 根据内容类型调整停留时间
- 识别"高质量"笔记，增加互动概率

### 2. 时间分布

- 模拟用户在一天中不同时段的活跃程度
- 早中晚不同的浏览习惯

### 3. 情感模拟

- 根据笔记内容生成更贴合的评论
- 模拟用户情绪波动（兴奋、疲倦）

### 4. 多设备模拟

- 移动端滚动特征（更多竖向滑动）
- 平板设备的浏览模式

### 5. 自然退出行为（已实现 ✅）

**当前实现**

- 60% 使用 ESC 键关闭笔记弹窗
- 40% 点击遮罩层/空白处关闭
- 保留滚动位置，不刷新页面

**为什么重要**

- 小红书的笔记详情是悬浮弹窗，不是新页面
- 真实用户不会"刷新页面"来退出笔记
- 保持滚动位置，体验更自然

## 总结

通过引入这些基于真实用户数据的优化参数，我们的浏览功能现在能够：

✅ 更真实地模拟人类浏览行为  
✅ 降低被检测为机器的风险  
✅ 提供更自然的交互体验  
✅ 保持足够的随机性和不可预测性

这些优化使得自动化浏览更加安全、自然，同时也为未来的进一步改进奠定了基础。

---

**最后更新**：2025-10-15  
**版本**：v2.0  
**作者**：xiaohongshu-mcp 团队
